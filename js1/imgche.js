$.fn.upload=function(e,t,r,a){"object"!=typeof t&&(a=r,r=t);var n=new FormData,o=0;if(this.each(function(){var e,t=this.files.length;for(o+=t,e=0;t>e;e++)n.append(this.name,this.files[e])}),"object"==typeof t)for(var p in t)n.append(p,t[p]);var s=new $.Deferred;return o>0?$.ajax({url:e,type:"POST",xhr:function(){return myXhr=$.ajaxSettings.xhr(),myXhr.upload&&a&&myXhr.upload.addEventListener("progress",function(e){var t=~~(e.loaded/e.total*100);"function"==typeof a?a(e,t):a&&$(a).val(t)},!1),myXhr},data:n,dataType:"json",cache:!1,contentType:!1,processData:!1,complete:function(e){var t;try{t=JSON.parse(e.responseText)}catch(a){t=e.responseText}"function"==typeof r&&r(t),s.resolve(t)}}):s.reject(),s.promise()};